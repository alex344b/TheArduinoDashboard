@page "/"
@using Microsoft.AspNetCore.Mvc.RazorPages
@inject HttpClient Http
@rendermode InteractiveServer




<PageTitle>Home</PageTitle>

<div class="container mt-5">
    
    <div class="text-center mb-5">
        <h1 class="fw-bold display-5">🐾 Cat Facts Dashboard</h1>
        <p class="text-muted fs-5">Discover fun and interesting facts about cats </p>
    </div>
    
    @if (catfacts == null)
    {
        <div class="text-center mt-5">
            <div class="spinner-border text-primary" role="status"></div>
            <p class="mt-3 fs-5">Fetching cat wisdom ... </p>
        </div>
    }
    else
    {
        <div class="row g-4">
            @foreach (CatFactDTO catfact in catfacts)
            {

                <div class="col-md-6 col-lg-4">
                    <div class="card shadow-sm border-0 rounded-4 h-100">
                        <div class="card-body">
                            <h5 class="card-title text-center fw-bold text-primary mb-3">🐱 Cat Fact
                            </h5>
                            <p class="card-text">
                                <CardsText1>Fact: @catfact.fact</CardsText1>
                            </p>
                            <div class="d-flex justify-content-between mt-3">
                                <span class="badge bg-success px-3 py-2">
                                    👍 Likes: @catfact.likes
                                </span>
                                <span class="badge bg-danger px-3 py-2">
                                    👎 Dislikes @catfact.dislikes
                                </span>
                            </div>

                            <p class="text-muted small mt-3 mb-0">
                                Date: @catfact.dateAdded
                            </p>

                        </div>
                    </div>
                </div>
            }
        </div>
    }

    <div class="text-center mb-5">

        <button class="btn btn-primary btn-lg shadow-sm px-44 mt-3" type="button" @onclick="LoadCatFactsAsync">Load More Facts</button>
    </div>

</div>

@code {

    private List<CatFactDTO> catfacts;

    private int currentPage = 1;
    
    private async Task<Pages> GetCatFactsAsync()
    {
        return await Http.GetFromJsonAsync<Pages>($"http://10.133.51.103:8080/api/CatFactGet?page={currentPage}&pageSize=10");
    }
    
    protected override async Task OnInitializedAsync()
    {
        var response = await GetCatFactsAsync();
        catfacts = response.data;
    }
    
    protected async Task LoadCatFactsAsync()
    {
        currentPage++;
        var response = await GetCatFactsAsync();
        if (response?.data!=null)
            catfacts.AddRange(response.data);
        
        StateHasChanged();
    }
}